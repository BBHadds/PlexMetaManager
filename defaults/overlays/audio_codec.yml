##############################################################################
#                            Audio Codec Overlay                             #
#                 Created by Yozora, Bullmoose20, & Sohjiro                  #
#                     Credit to Magic815 for base images                     #
#          EDITING THIS FILE MAY CAUSE PULLING NEW UPDATES TO FAIL           #
#   https://metamanager.wiki/en/latest/defaults/overlays/audio_codec.html    #
##############################################################################

external_templates:
  pmm: templates
  template_variables:
    conditionals:
      back_height:
        default: 105
        conditions:
          - style: standard
            value: <<standard_value>>
    default:
      standard_value: 105
      style: compact
    group: audio_codec
    horizontal_offset: 0
    horizontal_align: center
    vertical_offset: 15
    vertical_align: top
    back_color: "#00000099"
    back_width: 305
    pmm: audio_codec/<<style>>/<<key>>

templates:
  audio_codec:
    default:
      regex_<<key>>: <<regex>>
    conditionals:
      regex:
        conditions:
          - key: truehd_atmos
            value: '(?i)^(?=.*\b(true[ .-]?hd))(?=.*\b(atmos(\b|\d))).*'
          - key: dtsx
            value: '(?i)^(?=.*(\b(dts[-_. ]?x)\b(?!\d))).*'
          - key: plus_atmos
            value: '(?i)^((?=.*(DD[P+](?!A)|eac3))(?=.*\b(atmos(\b|\d))))|^(?=.*\b(DDPA(\b|\d))).*'
          - key: dolby_atmos
            value: '(?i)^(?!.*([^-]DD[P+](?!A)|eac3|true[ .-]?hd))(?=.*\b(atmos(\b|\d))).*'
          - key: truehd
            value: '(?i)^(?!.*(atmos))(?=.*\b(true[ .-]?hd)\b).*'
          - key: ma
            value: '(?i)^(?=.*(\b(dts[-_. ]?(ma|hd([-_. ]?ma)?(?![-_. ]?(hr|hi))|xll))\b)).*'
          - key: flac
            value: '(?i)^(?=.*(\bFLAC(\b|\d))).*'
          - key: pcm
            value: '(?i)^(?=.*(\b(l?)PCM(\b|\d))).*'
          - key: hra
            value: '(?i)^(?=.*(dts[-. ]?(hd[. ]?)?(hra?|hi\b))).*'
          - key: plus
            value: '(?i)^(?!.*(atmos))(?=.*\b(DD[P+](?!A)|e[-_. ]?ac3\b)).*'
          - key: dtses
            value: '(?i)^(?=.*(dts[-. ]?es\b)).*'
          - key: dts
            value: '(?i)^(?!.*(\b(dts[-_. ]?(ma|hd([-_. ]?ma)?|xll))\b|dts[-. ]?(es|(hd[. ]?)?(hr|hi))|\b(dts[-_. ]?x)\b(?!\d)))(?=.*(\bDTS(\b|\d))).*'
          - key: digital
            value: '(?i)^(?=.*(\bDD[^a-z+]|(?<!e)ac3)).*'
          - key: aac
            value: '(?i)^(?=.*(\baac(\b|\d))).*'
          - key: mp3
            value: '(?i)^(?=.*(\bmp3(\b|\d))).*'
          - key: opus
            value: '(?i)\^(?=.*(\b[^-]OPUS(\b|\d))).*'
    ignore_blank_results: true
    plex_all: true
    filters:
      - audio_track_title.regex: <<regex_<<key>>>>
      - filepath.regex: <<regex_<<key>>>>

overlays:

  Dolby-TrueHD-Atmos:
    variables: {key: truehd_atmos, weight: 160, standard_value: 189}
    template: [name: standard, name: audio_codec]

  DTS-X:
    variables: {key: dtsx, weight: 150}
    template: [name: standard, name: audio_codec]

  Dolby-Digital-Plus-Atmos:
    variables: {key: plus_atmos, weight: 140, standard_value: 189}
    template: [name: standard, name: audio_codec]

  Dolby-Atmos:
    variables: {key: dolby_atmos, weight: 130}
    template: [name: standard, name: audio_codec]

  Dolby-TrueHD:
    variables: {key: truehd, weight: 120}
    template: [name: standard, name: audio_codec]

  DTS-HD-MA:
    variables: {key: ma, weight: 110}
    template: [name: standard, name: audio_codec]

  FLAC:
    variables: {key: flac, weight: 100}
    template: [name: standard, name: audio_codec]

  PCM:
    variables: {key: pcm, weight: 90}
    template: [name: standard, name: audio_codec]

  DTS-HD-HRA:
    variables: {key: hra, weight: 80}
    template: [name: standard, name: audio_codec]

  Dolby-Digital-Plus:
    variables: {key: plus, weight: 70}
    template: [name: standard, name: audio_codec]

  DTS-ES:
    variables: {key: dtses, weight: 60}
    template: [name: standard, name: audio_codec]

  DTS:
    variables: {key: dts, weight: 50}
    template: [name: standard, name: audio_codec]

  Dolby-Digital:
    variables: {key: digital, weight: 40}
    template: [name: standard, name: audio_codec]

  AAC:
    variables: {key: aac, weight: 30}
    template: [name: standard, name: audio_codec]

  MP3:
    variables: {key: mp3, weight: 20}
    template: [name: standard, name: audio_codec]

  Opus:
    variables: {key: opus, weight: 10}
    template: [name: standard, name: audio_codec]
